---
title: "Optimization algorithms"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{User guide}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(ospsuite.parameteridentification)
knitr::opts_knit$set(
  root.dir = ".."
)
```


## Introduction

The `ospsuite.parameteridentification` package incorporates a selection of optimization algorithms designed for efficient parameter estimation within pharmacokinetic models. By utilizing robust algorithms from third-party R packages, it offers a solution to optimize parameter values effectively. This guide explores the distinct algorithms included, detail their adjustable options, and provide recommendations on selecting the most suitable algorithm for various optimization challenges.


## Used algorithms

### BOBYQA from `nloptr` package

BOBYQA (Bound Optimization BY Quadratic Approximation) is a local, derivative-free optimization method, well-suited for smooth functions where gradient information is not available or unreliable. This method is particularly effective for optimization problems with a relatively small number of parameters.

**Default Options:**

- `stopval = -Inf`: Stops the minimization process if the objective function reaches this value.
- `xtol_rel = 1e-6`: Terminates optimization when the relative size of the optimization step is less than this value.
- `maxeval = 1000`: Limits the number of function evaluations to this value, after which the optimization process stops.
- `ftol_rel = 0.0`: Stops the optimization when the relative change in the objective function value between iterations is smaller than this value.
- `ftol_abs = 0.0`: Ends the optimization process when the absolute change in the objective function value between iterations falls below this threshold.
- `check_derivatives = FALSE`: If `TRUE`, the derivatives of the objective function (if provided) are checked for correctness.

For detailed documentation on BOBYQA and its implementation, refer to the [`nloptr` package documentation on CRAN](https://CRAN.R-project.org/package=nloptr).




### HJKB from `dfoptim` package

The Hooke-Jeeves algorithm, implemented in the HJKB method, is a derivative-free optimization technique that navigates the parameter space through a pattern search method of varying step sizes. It is particularly effective for optimization problems characterized by discontinuities or noisy objective functions.

**Default Options:**

- `tol = 1e-06`: Terminates optimization when the relative size of the optimization step is smaller than this value, indicating convergence.
- `maxfeval = Inf`: Specifies the maximum number of objective function evaluations allowed before halting the optimization, offering a boundless evaluation scope by default.
- `maximize = FALSE`: Determines the optimization direction; set to `FALSE` to minimize the objective function, aligning with common optimization tasks.
- `target = Inf`: Sets a stopping criterion based on achieving an objective function value; optimization halts if this target is exceeded, providing a theoretical bound in practical scenarios.
- `info = FALSE`: Controls the verbosity of the optimization process; set to `FALSE` to suppress intermediate status information, maintaining a cleaner output.



```{r}
piConfiguration <- PIConfiguration$new()
piConfiguration$algorithm <- "HJKB"
piConfiguration$algorithmOptions <- list(
  tol = 1e-06,
  maxfeval = Inf
)
```

For detailed documentation on HJKB and its implementation, refer to the [`dfoptim` package documentation on CRAN](https://CRAN.R-project.org/package=dfoptim).


### DEoptim from `DEoptim` package

DEoptim utilizes the Differential Evolution (DE) algorithm, a robust global stochastic optimization technique designed to tackle complex, multimodal problems. It shines in scenarios where local optimization methods are unable to locate the global optimum, making it ideal for intricate optimization challenges.

**Default Options:**

- `VTR = -Inf`: Specifies the value to reach for termination. Optimization stops if the function value of the best parameter vector is less than or equal to this threshold or if `itermax` is reached.
- `strategy = 2`: Determines the DE strategy employed in the optimization process, with various strategies available to influence how new solutions are generated.
- `NP = NA`: The population size. A larger population may improve the search but increases computational cost.
- `itermax = 200`: The maximum number of generations before the optimization halts, ensuring the process concludes even in complex search spaces.
- `CR = 0.5`: The crossover probability, dictating the likelihood of offspring inheriting traits from different parents, influencing diversity in the population.
- `F = 0.8`: The differential weight factor, affecting the variation between generations and the convergence rate.
- `bs = FALSE`: Toggles between standard selection (`FALSE`) and "best of parent and offspring" selection (`TRUE`), affecting survival criteria.
- `trace = TRUE`: Enables printing of algorithm progress and status information, offering insights into the optimization process.

For detailed documentation on DEoptim and its implementation, refer to the [`DEoptim` package documentation on CRAN](https://CRAN.R-project.org/package=DEoptim).




## Choosing an Algorithm

- **`BOBYQA`** is the default algorithm due to its efficiency in handling typical optimization tasks with fewer parameters and smooth objective functions.

- **`HJKB`** should be considered for problems with discontinuous objective functions or when derivative information is problematic.

- **`DEoptim`** is best suited for highly complex problems, especially those with many local minima or requiring global optimization strategies.

Selecting the appropriate algorithm depends on the nature of your optimization problem and the characteristics of the objective function. Experimenting with different algorithms under varying settings can provide insights into the most effective approach for your specific task.


## References

- M. J. D. Powell, "The BOBYQA algorithm for bound constrained optimization without derivatives," Cambridge NA Report NA2009/06, University of Cambridge, 2009.

- C. T. Kelley, "Iterative Methods for Optimization," Society for Industrial and Applied Mathematics, 1999.




