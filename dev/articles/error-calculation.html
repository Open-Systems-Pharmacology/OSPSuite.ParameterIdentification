<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ospsuite.parameteridentification">
<title>Error calculation â€¢ ospsuite.parameteridentification</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Error calculation">
<meta property="og:description" content="ospsuite.parameteridentification">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ospsuite.parameteridentification</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Parameter identification workflow</h6>
    <a class="dropdown-item" href="../articles/user-guide.html">User guide</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Details</h6>
    <a class="dropdown-item" href="../articles/error-calculation.html">Error calculation</a>
    <a class="dropdown-item" href="../articles/optimization-algorithms.html">Optimization algorithms</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/open-systems-pharmacology/ospsuite.parameteridentification/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Error calculation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/open-systems-pharmacology/ospsuite.parameteridentification/blob/HEAD/vignettes/error-calculation.Rmd" class="external-link"><code>vignettes/error-calculation.Rmd</code></a></small>
      <div class="d-none name"><code>error-calculation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In the parameter identification (PI) process, measuring the
discrepancy between simulated results and observed data is crucial. The
<code>ospsuite.parameteridentification</code> package offers two primary
error models to quantify this difference: the least squares error
(<code>lsq</code>) and the M3 method (<code>m3</code>) for handling data
below the quantification limit (BQL).</p>
</div>
<div class="section level2">
<h2 id="error-models">Error Models<a class="anchor" aria-label="anchor" href="#error-models"></a>
</h2>
<div class="section level3">
<h3 id="lsq---least-squares-error">LSQ - Least Squares Error<a class="anchor" aria-label="anchor" href="#lsq---least-squares-error"></a>
</h3>
<p>The <code>lsq</code> method is a traditional approach that minimizes
the sum of the squared differences between observed and simulated
values. This method is widely used in pharmacokinetic modeling, offering
a straightforward and intuitive error calculation. By default, selecting
this method will transform BQL data by replacing it with LLOQ/2.</p>
</div>
<div class="section level3">
<h3 id="m3---extended-least-squares-error">M3 - Extended Least Squares Error<a class="anchor" aria-label="anchor" href="#m3---extended-least-squares-error"></a>
</h3>
<p>The <code>m3</code> method extends the least squares error by
incorporating the likelihood of observed data being below the
quantification limit. This method treats BQL data as censored, applying
maximum likelihood estimation to include all data in the model fit, thus
offering a more accurate and statistically robust approach to handling
BQL observations.</p>
</div>
<div class="section level3">
<h3 id="configuring-error-models-in-pi">Configuring Error Models in PI<a class="anchor" aria-label="anchor" href="#configuring-error-models-in-pi"></a>
</h3>
<p>To apply an error model, set the <code>targetFunctionType</code>
attribute in <code>objectFunctionOptions</code> of the
<code>PIConfiguration</code> object:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">piConfiguration</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PIConfiguration.html">PIConfiguration</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">piConfiguration</span><span class="op">$</span><span class="va">objectiveFunctionOptions</span><span class="op">$</span><span class="va">objectiveFunctionType</span> <span class="op">&lt;-</span> <span class="st">"lsq"</span> <span class="co"># or "m3"</span></span></code></pre></div>
<p>The error calculation between simulated results and observer datasets
within each <code>PIOutputMapping</code> directly affects the
optimization process, aggregating errors across all mappings.</p>
</div>
</div>
<div class="section level2">
<h2 id="advanced-error-model-customization">Advanced Error Model Customization<a class="anchor" aria-label="anchor" href="#advanced-error-model-customization"></a>
</h2>
<div class="section level3">
<h3 id="residual-weighting">Residual Weighting<a class="anchor" aria-label="anchor" href="#residual-weighting"></a>
</h3>
<p><code>PIConfiguration</code> offers further customization for error
calculation through the <code>residualWeightingMethod</code>. This
option specifies how residuals are weighted. These methods are
advantageous when observed data comes from diverse populations, when
datasets comprise different observation counts, or when error of
dependent variable is measured. Available options include:</p>
<ul>
<li>
<strong><code>none</code></strong>: (default): No residual
weighting.</li>
<li>
<strong><code>std</code></strong>: Useful when variability in
observed data points is high, as it normalizes residuals by the standard
deviation, mitigating the impact of outliers.</li>
<li>
<strong><code>mean</code></strong>: Beneficial for datasets with
significant differences in observation magnitudes, scaling residuals by
the mean to ensure equal contribution across data points.</li>
<li>
<strong><code>error</code></strong>: Ideal when individual data
points come with their variance estimates, allowing for weighting by the
inverse of these variances, which can provide a more tailored fit given
the know error.</li>
</ul>
<p>To apply residual weighting, set the
<code>residualWeightingMethod</code> attribute in
<code>objectFunctionOptions</code> of the <code>PIConfiguration</code>
object:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">piConfiguration</span><span class="op">$</span><span class="va">objectiveFunctionOptions</span><span class="op">$</span><span class="va">residualWeightingMethod</span> <span class="op">&lt;-</span> <span class="st">"std"</span> <span class="co"># or "mean" or "error"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="robust-residual-calculation">Robust Residual Calculation<a class="anchor" aria-label="anchor" href="#robust-residual-calculation"></a>
</h3>
<p>For enhanced flexibility in handling outliers, Â´PIConfigurationÂ´
allows specifying a robust method for residual adjustment. Implementing
a robustMethod for residuals directly addresses outlier influence,
refining model robustness and ensuring more reliable parameter
identification outcomes. Available options include:</p>
<ul>
<li>
<strong><code>none</code></strong> (default): No robust adjustments,
treating all residuals equally.</li>
<li>
<strong><code>huber</code></strong>: Minimizes the impact of
outliers by combining squared and absolute values, making it less
sensitive to extreme deviations.</li>
<li>
<strong><code>bisquare</code></strong>: Further reduces the
influence of outliers by applying a weighting scheme that diminishes the
role of residuals as they move away from the median.</li>
</ul>
<p>To apply robust residual calculation, set the
<code>robustMethod</code> attribute in
<code>objectFunctionOptions</code> of the <code>PIConfiguration</code>
object:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">piConfiguration</span><span class="op">$</span><span class="va">objectiveFunctionOptions</span><span class="op">$</span><span class="va">robustMethod</span> <span class="op">&lt;-</span> <span class="st">"huber"</span> <span class="co"># or "bisquare"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="scaling-impact">Scaling Impact<a class="anchor" aria-label="anchor" href="#scaling-impact"></a>
</h3>
<p>The PIOutputMapping$scaling attribute, adjustable to log or lin,
crucially shapes the error modelâ€™s effectiveness and residual
calculations. Logarithmic scaling is particularly advantageous for
datasets with broad ranges, ensuring proportionate errors and uniform
residuals, thereby reducing skewness in error distribution and enhancing
model convergence stability.</p>
<p>To change the default
Â´lin<code>scaling, set the</code>scaling<code>attribute in</code>PIOutputMapping`:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outputMapping</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PIOutputMapping.html">PIOutputMapping</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>quantity <span class="op">=</span> <span class="va">testQuantity</span><span class="op">)</span></span>
<span><span class="va">outputMapping</span><span class="op">$</span><span class="va">scaling</span> <span class="op">&lt;-</span> <span class="st">"log"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Beal SL. (2001). Ways to fit a PK model with some data below the
quantification limit. <em>Journal of Pharmacokinetics and
Pharmacodynamics</em>, 28(5), 481-504. <a href="https://doi.org/10.1023/a:1012299115260" class="external-link">DOI:
10.1023/a:1012299115260</a>.</p></li>
<li><p>Fox, J. &amp; Weisberg, S. (2013). Robust Regression. College of
Liberal Arts - Statistics, Minneapolis.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://esqlabs.com/" class="external-link"><img src="https://esqlabs.github.io/esqlabsR/reference/figures/esqlabs.png" style="max-width:33px">esqLABS</a>, <a href="https://github.com/PavelBal" class="external-link">Pavel Balazki</a>, <a href="https://github.com/svavil" class="external-link">Sergei Vavilov</a>, <a href="https://github.com/rengelke" class="external-link">Rudi Engelke</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
