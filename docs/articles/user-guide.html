<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ospsuite.parameteridentification">
<title>User guide â€¢ ospsuite.parameteridentification</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="User guide">
<meta property="og:description" content="ospsuite.parameteridentification">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ospsuite.parameteridentification</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/user-guide.html">User guide</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/open-systems-pharmacology/ospsuite.parameteridentification/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>User guide</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/open-systems-pharmacology/ospsuite.parameteridentification/blob/HEAD/vignettes/user-guide.Rmd" class="external-link"><code>vignettes/user-guide.Rmd</code></a></small>
      <div class="d-none name"><code>user-guide.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="parameter-estimation-problems">Parameter estimation problems<a class="anchor" aria-label="anchor" href="#parameter-estimation-problems"></a>
</h2>
<p>Biosimulation models often include numerical parameters that
determine the outputs of the model. Often, the values of these
parameters are not known in advance and have to be identified by
matching possible model outputs to the observed data. Finding parameter
values that best match the observed data is called <em>parameter
estimation</em>.</p>
<p>The <a href="https://github.com/open-systems-pharmacology/ospsuite.parameteridentification" class="external-link">ospsuite.parameteridentification</a> package provides
a class for setting up such tasks based on existing PKML models, mapping
model outputs to observed data and estimating parameters. Below, a model
example shows a case of investigating <a href="https://github.com/Open-Systems-Pharmacology/Example_Aciclovir" class="external-link">an
existing open-source biosimulation model of aciclovir</a>.</p>
</div>
<div class="section level2">
<h2 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a>
</h2>
<p>The package includes a <code>PIConfiguration</code> class for storing
and re-using the settings of the parameter identification task.
Currently, the implemented options include:</p>
<ul>
<li><p><code>printIterationFeedback</code> (logical) indicates if the
objective function value should be printed at each iteration</p></li>
<li><p><code>targetFunctionType</code> (possible values: lsq, m3)
indicates which objective function should be used to quantify the
difference between observed data and simulated curve. The M3 method from
<a href="https://link.springer.com/article/10.1023/A:1012299115260" class="external-link">Beal,
2001</a> is an objective function that accounts for possible data points
below the lower limit of quantification.</p></li>
<li><p><code>algorithm</code> (possible values: bobyqa, Marq, Port,
Newton, Nelder-Mead, BFGS, CG, L-BFGS-B, SANN, Pseudo) indicates which
of the optimization algorithms should be used. Control options can be
specified as list and passed to
<code>piConfiguration$algorithmOptions</code>.</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">piConfiguration</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PIConfiguration.html">PIConfiguration</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">piConfiguration</span><span class="op">$</span><span class="va">printIterationFeedback</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extracting-parameters-from-the-model">Extracting parameters from the model<a class="anchor" aria-label="anchor" href="#extracting-parameters-from-the-model"></a>
</h2>
<p>A sample PKML file with the model is shipped with the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">loadSimulation</span><span class="op">(</span><span class="st">"tests/dev/Models/Simulations/Aciclovir.pkml"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">simulations</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Aciclovir"</span></span></code></pre></div>
<p>The parameter corresponding to the lipophilicity of aciclovir is
called <code>Aciclovir|Lipophilicity</code> within the model. The
parameter describing the clearance is called
<code>Neighborhoods|Kidney_pls_Kidney_ur|Aciclovir|Renal Clearances-TS|TSspec</code>.
You can also look up parameters in the model using</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">getAllParametersMatching</span><span class="op">(</span><span class="st">"**|TSspec"</span>, <span class="va">simulations</span><span class="op">$</span><span class="va">Aciclovir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Parameter: </span></span>
<span><span class="co">#&gt;    Path: Neighborhoods|Kidney_pls_Kidney_ur|Aciclovir|Renal Clearances-TS|TSspec </span></span>
<span><span class="co">#&gt;    Value: 0.94 [1/min] </span></span>
<span><span class="co">#&gt;    isFormula: TRUE </span></span>
<span><span class="co">#&gt;    formula: TS / V_kid </span></span>
<span><span class="co">#&gt;    Value overrides formula: FALSE </span></span>
<span><span class="co">#&gt;    isStateVariable: FALSE</span></span></code></pre></div>
<p>The package has a <code>PIParameter</code> class to represent the
varying parameters in the model and store them along with the starting
value, the lower and the upper bounds of the parameter search space.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va"><a href="../reference/PIParameters.html">PIParameters</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>parameters <span class="op">=</span> <span class="fu">ospsuite</span><span class="fu">::</span><span class="fu"><a href="https://www.open-systems-pharmacology.org/OSPSuite-R/reference/getParameter.html" class="external-link">getParameter</a></span><span class="op">(</span></span>
<span>    path <span class="op">=</span> <span class="st">"Aciclovir|Lipophilicity"</span>, </span>
<span>    container <span class="op">=</span> <span class="va">simulations</span><span class="op">$</span><span class="va">Aciclovir</span></span>
<span>  <span class="op">)</span><span class="op">)</span>, <span class="va"><a href="../reference/PIParameters.html">PIParameters</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>parameters <span class="op">=</span> <span class="fu">ospsuite</span><span class="fu">::</span><span class="fu"><a href="https://www.open-systems-pharmacology.org/OSPSuite-R/reference/getParameter.html" class="external-link">getParameter</a></span><span class="op">(</span></span>
<span>    path <span class="op">=</span> <span class="st">"Neighborhoods|Kidney_pls_Kidney_ur|Aciclovir|Renal Clearances-TS|TSspec"</span>,</span>
<span>    container <span class="op">=</span> <span class="va">simulations</span><span class="op">$</span><span class="va">Aciclovir</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The default bounds are 0.1 of the starting parameter value and 10.0
of the starting parameter value, but it is often useful to supply
parameter bounds from previous knowledge:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parameters</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">minValue</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">5</span></span>
<span><span class="va">parameters</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maxValue</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">parameters</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">minValue</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">parameters</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maxValue</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reading-observed-data">Reading observed data<a class="anchor" aria-label="anchor" href="#reading-observed-data"></a>
</h2>
<p>We need to supply the observed data which we are going to use to
identify parameter values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filePath</span> <span class="op">&lt;-</span> <span class="st">"tests/data/AciclovirLaskinData.xlsx"</span></span>
<span><span class="va">dataConfiguration</span> <span class="op">&lt;-</span> <span class="fu">createImporterConfigurationForFile</span><span class="op">(</span>filePath <span class="op">=</span> <span class="va">filePath</span><span class="op">)</span></span>
<span><span class="va">dataConfiguration</span><span class="op">$</span><span class="va">sheets</span> <span class="op">&lt;-</span> <span class="st">"Laskin 1982.Group A"</span></span>
<span><span class="va">dataConfiguration</span><span class="op">$</span><span class="va">namingPattern</span> <span class="op">&lt;-</span> <span class="st">"{Source}.{Sheet}"</span></span>
<span><span class="va">observedData</span> <span class="op">&lt;-</span> <span class="fu">loadDataSetsFromExcel</span><span class="op">(</span>xlsFilePath <span class="op">=</span> <span class="va">filePath</span>, importerConfigurationOrPath <span class="op">=</span> <span class="va">dataConfiguration</span><span class="op">)</span></span></code></pre></div>
<p>Here, the <em>importer configuration</em> is created with the
<code>createImporterConfigurationForFile</code> helper function that
tries to guess column names in the Excel file. If you run into errors
while importing the data, try to create the importer configuration from
the PK-Sim GUI, export it as an <code>XML</code> file and re-use it for
importing observed data into R as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filePath</span> <span class="op">&lt;-</span> <span class="st">"tests/data/AciclovirLaskinData.xlsx"</span></span>
<span><span class="va">dataConfiguration</span> <span class="op">&lt;-</span> <span class="fu">loadDataImporterConfiguration</span><span class="op">(</span><span class="st">"tests/data/dataImporter_configuration.xml"</span><span class="op">)</span></span>
<span><span class="va">observedData</span> <span class="op">&lt;-</span> <span class="fu">loadDataSetsFromExcel</span><span class="op">(</span>xlsFilePath <span class="op">=</span> <span class="va">filePath</span>, importerConfigurationOrPath <span class="op">=</span> <span class="va">dataConfiguration</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mapping-data-to-model-outputs">Mapping data to model outputs<a class="anchor" aria-label="anchor" href="#mapping-data-to-model-outputs"></a>
</h2>
<p>Typically, the observed data show the concentration of the compound
in the peripheral blood flow, but there can be other setups. A class
from the package that matches the model outputs and the observations is
called <code>PIOutputMapping</code>, for example:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outputMapping</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PIOutputMapping.html">PIOutputMapping</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>quantity <span class="op">=</span> <span class="fu">getQuantity</span><span class="op">(</span><span class="st">"Organism|PeripheralVenousBlood|Aciclovir|Plasma (Peripheral Venous Blood)"</span>,</span>
<span>  container <span class="op">=</span> <span class="va">simulations</span><span class="op">$</span><span class="va">Aciclovir</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">outputMapping</span><span class="op">$</span><span class="fu">addObservedDataSets</span><span class="op">(</span><span class="va">observedData</span><span class="op">$</span><span class="va">`AciclovirLaskinData.Laskin 1982.Group A`</span><span class="op">)</span></span>
<span><span class="va">outputMapping</span><span class="op">$</span><span class="va">scaling</span> <span class="op">&lt;-</span> <span class="st">"lin"</span></span>
<span><span class="va">outputMappings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">outputMapping</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-parameter-estimation">Running parameter estimation<a class="anchor" aria-label="anchor" href="#running-parameter-estimation"></a>
</h2>
<p>After the <code>outputMappings</code>, <code>simulations</code>,
<code>parameters</code> and <code>piConfiguration</code> objects are
created, they are used in an instance of the
<code>ParameterIdentification</code> class as follows:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/ParameterIdentification.html">ParameterIdentification</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  simulations <span class="op">=</span> <span class="va">simulations</span>,</span>
<span>  parameters <span class="op">=</span> <span class="va">parameters</span>,</span>
<span>  outputMappings <span class="op">=</span> <span class="va">outputMapping</span>,</span>
<span>  configuration <span class="op">=</span> <span class="va">piConfiguration</span></span>
<span><span class="op">)</span></span>
<span><span class="va">task_results</span> <span class="op">&lt;-</span> <span class="va">task</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If <code>piConfiguration$printIterationFeedback</code> is set to
<code>TRUE</code>, each iteration will print a single line with the
current objective function value, to track the performance of the
optimization algorithm.</p>
</div>
<div class="section level2">
<h2 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a>
</h2>
<p>The resulting object contains:</p>
<ul>
<li>
<code>task_results$par</code>: a vector of point estimates for each
of the parameters</li>
<li>
<code>task_results$lwr</code> and <code>task_results$upr</code>:
vectors with lower bounds and upper bounds for the 95% confidence
interval for each of the parameters</li>
<li>
<code>task_results$cv</code>: a vector with coefficient of variation
(standard deviation over point estimate, in percents) for each of the
parameters</li>
</ul>
<p>The <code>task</code> object also contains a
<code>$plotResults()</code> function that produces three diagnostic
plots: an individual time profile with the current best estimate of
model parameters and overlayed observed data, a comparison of
predicted-vs-observed values and a plot of residuals vs time to identify
potential biases in the model. The <code>$plotResults()</code> function
can take an optional vector of parameter values to plot the curve
corresponding to another set of model parameters.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Pavel Balazki, Sergei Vavilov.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
